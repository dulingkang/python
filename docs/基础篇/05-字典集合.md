# 05-字典集合
Python内置了字典：dict的支持，dict全称dictionary，在其他语言中也称为map，使用键-值（key-value）存储，具有极快的查找速度。
那究竟什么是字典，什么是集合呢？字典是一系列由键（key）和值（value）配对组成的元素的集合，在Python3.7+，字典被确定为有序（注意：在3.6中，字典有序是一个implementation detail，在3.7才正式成为语言特性，因此3.6中无法100%确保其有序性），而3.6之前是无序的，其长度大小可变，元素可以任意地删减和改变。
相比于列表和元组，字典的性能更优，特别是对于查找、添加和删除操作，字典都能在常数时间复杂度内完成。
而集合和字典基本相同，唯一的区别，就是集合没有键和值的配对，是一系列无序的、唯一的元素组合。
## 更新添加
更新添加操作：
```Python
d['lily'] = 90
s.add('lily')
d, s
Out[53]: {'bob': 30, 'tom': 45, 'lily': 90}, {'bob', 'tom', 'lily'}
```
每次向字典或集合插入一个元素时，`Python`会首先计算键的哈希值`（hash(key))`，再和 `mask = PyDicMinSize - 1`做与操作，计算这个元素应该插入哈希表的位置`index = hash(key) & mask`。如果哈希表中此位置是空的，那么这个元素就会被插入其中。
而如果此位置已被占用，`Python`便会比较两个元素的哈希值和键是否相等。
若两者都相等，则表明这个元素已经存在，如果值不同，则更新值。
若两者中有一个不相等，这种情况我们通常称为哈希冲突（`hash collision`），意思是两个元素的键不相等，但是哈希值相等。这种情况下，`Python`便会继续寻找表中空余的位置，直到找到位置为止, `Python`内部对此有优化

## 读取
```Python
d, s = {'bob': 30, 'tom': 45}, {'bob', 'tom'}
```
读取操作有两种方式：
```Python
d.get('bob')
Out[43]: 30
d.get('bbbb', 'error')
Out[44]: 'error'
d['bob']
Out[46]: 30
```
get操作带默认值这种不容易出错，直接`d['bbb']` key值bbb不存在会报错
判断key值是否存在都可以用 `in`：
```Python
'bob' in d
Out[47]: True
'bob' in s
Out[48]: True
```
和前面的插入操作类似，Python会根据哈希值，找到其应该处于的位置；然后，比较哈希表这个位置中元素的哈希值和键，与需要查找的元素是否相等。如果相等，则直接返回；如果不等，则继续查找，直到找到空位或者抛出异常为止。

## 删除
```Python
d.pop('tom')
Out[51]: 45
s.remove('tom')
d, s
Out[53]: ({'bob': 30, 'lily': 90}, {'bob', 'lily'})
# 另一种删除方法
del d['lily']
d
Out[55]: {'bob': 30}
```
对于删除操作，`Python`会暂时对这个位置的元素，赋于一个特殊的值，等到重新调整哈希表的大小时，再将其删除。
不难理解，哈希冲突的发生，往往会降低字典和集合操作的速度。因此，为了保证其高效性，字典和集合内的哈希表，通常会保证其至少留有1/3的剩余空间。随着元素的不停插入，当剩余空间小于1/3时，`Python`会重新获取更大的内存空间，扩充哈希表。不过，这种情况下，表内所有的元素位置都会被重新排放。
虽然哈希冲突和哈希表大小的调整，都会导致速度减缓，但是这种情况发生的次数极少。所以，平均情况下，这仍能保证插入、查找和删除的时间复杂度为O(1)。
## 排序
按照分数排序：
```Python
d, s = {'bob': 30, 'tom': 45, 'lily': 90}, {'bob', 'tom', 'lily'}
sorted(d.items(), key=lambda x:x[1])
Out[63]: [('bob', 30), ('tom', 45), ('lily', 90)]
```
字典排序后，列表中的元素变成了元组，对于集合排序：
```Python
s = {'bob', 'lily', 'tom'}
sorted(s)
Out[68]: ['bob', 'lily', 'tom']
```
返回一个排序好的列表
## 遍历
遍历字典：
```Python
for k, v in d.items():
    print(k,v)  
bob 30
tom 45
lily 90
for key in d:
    print(key, d[key])
bob 30
tom 45
lily 90
```
遍历集合：
```Python
for i in s:
    print(i)
lily
bob
tom
```
## 总结
- 字典在`Python3.7+`是有序的数据结构，而集合是无序的，其内部的哈希表存储结构，保证了其查找、插入、删除操作的高效性
- 字典和集合通常运用在对元素的高效查找、去重等场景。
- 使用`key-value`存储结构的`dict`在`Python`中非常有用，选择不可变对象作为key很重要，最常用的key是字符串。tuple虽然是不变对象，但试试把(1, 2, 3)和(1, [2, 3])放入dict或set中，试着看下结果。